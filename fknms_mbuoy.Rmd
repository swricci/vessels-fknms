---
title: "FKNMS Mooring Buoy Vessel Noise"
author: "Shannon Ricci"
date: "5/7/2019"
output: html_document
---

```{r}





```


##Get sound spectra for dBSea
Using R code provided by Veirs et al 2016, extract median source level spectra for the vessel catergories of interest for this study. Data downloaded from <http://www.beamreach.org/data/staff-research/ship-noise/>

The following code produced: a csv file that was used to load source level information into dBSea noise propagation modeling software and a figure of the source level spectra for each vessel type (using code adapted from Veirs et al)
```{r, eval = F}
library(data.table)
library(pracma)
library(scales)

load("data/vessel_SL/df_ALL_quant_linear_SL.Rdata")

dt_vessel_SL<-data.table(df_ALL_quant_linear_SL)

#interpolate SL at octave frequencies for dBSea input
library(pracma)
fcenter  <- 10^3 * (2 ^ (seq(-14,17,1)/3))
fcenter_dBsea <- 10^3 * (2 ^ (seq(-18,22,1)/3))

recreational_q50<-dt_vessel_SL[class == "Pleasure craft", .(q50.avg = mean(q50)),by=fhz]
recreational_q50_octave<-interp1(recreational_q50$fhz,recreational_q50$q50.avg,fcenter)
recreational_q50_dbsea<-rbind(fcenter, recreational_q50_octave)

recreational_q95<-dt_vessel_SL[class == "Pleasure craft", .(q95.avg = mean(q95)),by=fhz]
recreational_q95_octave<-interp1(recreational_q95$fhz,recreational_q95$q95.avg,fcenter)
recreational_q95_dbsea<-rbind(fcenter, recreational_q95_octave)

write.csv(recreational_q50_dbsea,file = "data/recreational_q50_SL.csv",row.names = T, quote = F)

write.csv(recreational_q95_dbsea,file = "data/recreational_q95_SL.csv",row.names = T, quote = F)

recreational_SL<-zone.tracks %>% 
  gather(key = "class", value = "tracks",`Tanker`:`Other`)

recreational_SL<-dt_vessel_SL[class == "Pleasure craft", .(q50.avg = mean(q50), q95.avg = mean(q95)),by=fhz]

recreational_SL<-recreational_SL %>% 
  gather(key = "quantile", value = "SPL",`q50.avg`:`q95.avg`)


ggplot() +
  scale_x_log10(breaks=c(10,100,1000,10000,100000),labels = trans_format("log10", math_format(10^.x)),lim=c(20,100000)) +
  annotation_logticks(sides = "tb") +
  geom_line(data=recreational_SL,aes(x = fhz, y = SPL, group = quantile, color = quantile), size = 1)+
scale_y_continuous(breaks=seq(30,280,10),lim=c(100,160))+ 
  ylab(expression(paste("Source level (dB re 1 ", mu, "Pa"^2,"/Hz @ 1m)")))+
  xlab("Frequency (Hz)")+
  theme_bw()+
  theme(panel.grid.major = element_line(colour="black", size=0.10),panel.grid.minor.y=element_line(color="black",size=0.05))+
  theme(legend.position = "right")+
  scale_color_manual(values = c("q50.avg" = "black","q95.avg" = "red"))

```